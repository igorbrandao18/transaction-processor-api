# Nginx configuration for exposing Grafana and Prometheus via sub-paths
# This file should be included in your main Nginx configuration on the production server

# Grafana - Accessible at https://challenge.brandaodeveloper.com.br/grafana
location /grafana/ {
    proxy_pass http://localhost:3001/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Prefix /grafana;
    
    # Grafana specific headers
    proxy_set_header X-Grafana-Referer $scheme://$host/grafana/;
    
    # WebSocket support for Grafana
    proxy_read_timeout 86400;
    proxy_buffering off;
}

# Prometheus - Accessible at https://challenge.brandaodeveloper.com.br/prometheus
location /prometheus/ {
    proxy_pass http://localhost:9090/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Prefix /prometheus;
    
    # Prometheus specific settings
    proxy_read_timeout 300;
    proxy_connect_timeout 300;
}

